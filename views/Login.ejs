<style>
    #input{
        border: none;
        background-color: rgb(93,172,189);
        color: rgb(36,82,122);
        border-bottom: rgb(36,82,122) 1px solid;
        text-align: center;
    }
    #input:focus-visible{
        outline: none;
    }
    input[type=submit]{
        outline: none;
        border: 1px solid rgb(36,82,122);
        color: rgb(36,82,122);
        background-color: rgb(93,172,189);
        cursor: pointer;
    }
    input[type=submit]:hover{
        color: rgb(93,172,189);
        background-color: rgb(36,82,122);
    }
</style>
<div id="page-content" style="display: flex; flex-direction: column; justify-content: center; align-items: center;">    
    <img src="/Logos/logo.png" style="height: 52%;">
    <div style="background-color: rgb(93,172,189); height: 40%; width: 35%;border-radius: 25px; color: rgb(36,82,122); align-items: center; display: flex; flex-direction: column;">
        <h1>Login Details</h1>      
        <form action="/auth/check_user" method="post" id="formId">
            <div style="display: flex; flex-direction: column; align-items: center;">
                <label for="input" id="Label">Email</label>
                <input type="email" required name="User_email" id="input"><br>
                <input type="submit" id="submitButton">
            </div>
        </form>
    </div>
</div>
<script>
function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i <ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}
function setCookie(cname, cvalue, exdays) {
  const d = new Date();
  d.setTime(d.getTime() + (exdays*24*60*60*1000));
  let expires = "expires="+ d.toUTCString();
  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}
flag=0
$(() => {
    $("#submitButton").click(function(ev) {
        ev.preventDefault()
        var form = $("#formId");
        if(flag)
        var data=form.serialize()+'&User_email='+getCookie("User_email")
        else
        data=form.serialize()
        console.log(flag, data)
        var url = form.attr('action');
        $.ajax({
            type: "POST",
            url: url,
            data: data,
            xhrFields: {
                withCredentials: true
            },
            success: function(data) {
                console.log(data["success"], data["key"])
                document.getElementById('Label').innerText='OTP'
                document.getElementById('input').setAttribute("name", "otp")
                document.getElementById('input').setAttribute("type", "text")
                document.getElementById('formId').setAttribute("action", "/auth/verify_otp")
                document.getElementById('input').value=''
                if(flag)
                console.log(flag && data.success=='Logged In Successfully.')
                if(flag && data["success"]=='Logged In Successfully.'){
                    setCookie("User_key", data.key, 365)
                    window.location.href='/dashboard'
                }
                else{
                    flag=1
                }
            },
            error: function(data) {
                alert("some Error");
            }
        });
    });
});
</script>